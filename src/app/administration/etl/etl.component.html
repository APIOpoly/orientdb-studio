<div class="row">

  <!-- <div *ngIf="!agentService.agent.active">
    <div class="col-md-12 studio-well-tips">
      <h4>This feature is available in OrientDB Enterprise Edition. To download OrientDB Enterprise Edition click <a href="http://orientdb.com/orientdb-enterprise/?#matrix" target='_blank'>here</a>.</h4>
    </div>
  </div> --> <!-- TODO reactivate the enterprise check -->

  <div>
    <form class="form-horizontal" id="etlForm" name="etlForm" #form="ngForm">
      <div id="stepSwitch" [ngSwitch]="getStep()">

        <div class="stepOne" *ngSwitchCase="'1'">
          <h3 align="center">Step 1 - Configure the Source</h3><br/>

          <div class="form-group">
            <label class="col-sm-2 control-label">Source Type</label>
            <div class="col-md-5">
              <select class="form-control" name="source" [(ngModel)]="configParams.source" required>
                <option *ngFor="let sourceType of sourceTypes" [value]="sourceType"> {{sourceType}} </option>
              </select>
            </div>
            <div class="col-md-5">
              <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                      [attr.data-content]="hints.sourceHint" data-animation="am-fade-and-scale"><b>?</b></button>
            </div>
          </div>
          <br><br><br>

          <!-- URL configuration -->
          <div class="form-group" *ngIf="configParams.source == 'url'">
            <label class="col-sm-2 control-label">File URL</label>
            <div class="col-md-5">
              <input type="url" id="fileURL" class="form-control" name="fileURL" [(ngModel)]="configParams.fileURL"
                     placeholder="URL of your file" pattern="https?://.+" required/>

            </div>
            <div class="col-md-5">
              <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                      [attr.data-content]="hints.URLHint" data-animation="am-fade-and-scale"><b>?</b></button>
            </div>
            <br><br>
            <label class="col-sm-2 control-label">HTTP Method</label>
            <div class="col-md-5">
              <select class="form-control" name="URLMethod" [(ngModel)]="configParams.URLMethod" required>
                <option *ngFor="let URLMethod of URLMethods" [selected]="URLMethod == 'GET'" [value]="URLMethod"> {{URLMethod}} </option>
              </select>
            </div>
            <div class="col-md-5">
              <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                      [attr.data-content]="hints.URLMethodHint" data-animation="am-fade-and-scale"><b>?</b></button>
            </div>
          </div>

          <!-- Local File configuration -->
          <div class="form-group" *ngIf="configParams.source == 'local file'">
            <label class="col-sm-2 control-label">File Path</label>
            <div class="col-md-5">
              <input type="text" id="filePath" class="form-control" name="filePath" [(ngModel)]="configParams.filePath"
                     placeholder="Local path of your file" pattern="^(?:[\w]\:|\\)(\\[a-z_\-\s0-9\.]+)+\.?" required/>
            </div>
            <div class="col-md-5">
              <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                      [attr.data-content]="hints.pathHint" data-animation="am-fade-and-scale"><b>?</b></button>
            </div>
            <br><br>
            <label class="col-sm-2 control-label">File Locking</label>
            <div class="col-md-5">
              <label>
                <input type="checkbox" name="fileLock" id="fileLock" class="checkbox" [(ngModel)]="configParams.fileLock">
              </label>
            </div>
            <div class="col-md-5">
              <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                      [attr.data-content]="hints.lockHint" data-animation="am-fade-and-scale"><b>?</b></button>
            </div>
          </div>

          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <div class="btn-toolbar">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-primary" (click)="sourceInit()" [disabled]="!form.valid">Start Configuration</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="stepTwo" *ngSwitchCase="'2'">
          <h3 align="center">Step 2 - Configure the ETL Parameters</h3>
          <h4 align="center">Chosen source: {{configParams.source}}</h4><br>
          <div class="row">
            <div class="col-sm-3">
              <h3 align="center">Extractor
                <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                        [attr.data-content]="hints.extractorHint" data-animation="am-fade-and-scale"><b>?</b></button>
              </h3>
              <div class="row" style="text-align: center;">
                <div class="btn-group">

                  <button class="btn btn-primary btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true"
                          aria-expanded="false" id="createExtractor">
                    <b>+</b>
                  </button>
                  <!-- Dropdown menu, jdbc is shown only if selected as source -->
                  <div class="dropdown-menu">
                    <li class="list-group-item list-group-item-info">Extractor Type</li>

                    <button type="button" class="list-group-item list-group-item-action" (click)="extractorInit('jdbc')" *ngIf="configParams.source == 'jdbc'">jdbc</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="extractorInit('csv')" *ngIf="configParams.source != 'jdbc'">csv</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="extractorInit('json')" *ngIf="configParams.source != 'jdbc'">json</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="extractorInit('row')" *ngIf="configParams.source != 'jdbc'">row</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="extractorInit('xml')" *ngIf="configParams.source != 'jdbc'">xml</button>
                    <a class="list-group-item list-group-item-action flex-column align-items-start active" *ngIf="configParams.source == 'jdbc'">
                      <div class="d-flex w-100 justify-content-between">
                        <small>Hint:</small>
                      </div>
                      <p class="mb-1">You selected jdbc previously. You have to use a jdbc extractor.</p>
                      <small>Please make sure that your jdbc driver is in classpath or in lib folder.</small>
                    </a>
                  </div>
                </div>
                <br><br><br>
                <div id="extractorSpace" class="row">
                  <h5 id="pleaseExtractor" align="center"><b>Please create an extractor</b></h5>
                </div>
              </div>
            </div>


            <div class="col-sm-6">
              <h3 align="center">Transformers
                <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                        [attr.data-content]="hints.transformerHint" data-animation="am-fade-and-scale"><b>?</b></button>
              </h3>
              <div class="row" style="text-align: center;">
                <div class="btn-group">

                  <button class="btn btn-primary btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <b>+</b>
                  </button>
                  <!-- Dropdown menu -->
                  <div class="dropdown-menu">
                    <li class="list-group-item list-group-item-info">Transformer Type</li>

                    <!--<button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('block')">block</button>-->
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('code')">code</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('command')">command</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('csv')">csv</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('edge')">edge</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('flow')">flow</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('field')">field</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('link')">link</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('log')">log</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('merge')">merge</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="transformerInit('vertex')">vertex</button>
                  </div>
                </div>
                <br><br><br>
                <div id="transformerSpace" class="row">
                  <h5 id="pleaseTransformer" align="center"><b>Please create at least one transformer</b></h5>
                </div>
              </div>
            </div>

            <div class="col-sm-3">
              <h3 align="center">Loader
                <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                        [attr.data-content]="hints.loaderHint" data-animation="am-fade-and-scale"><b>?</b></button>
              </h3>
              <div class="row" style="text-align: center;">
                <div class="btn-group">

                  <button class="btn btn-primary btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true"
                          aria-expanded="false" id="createLoader">
                    <b>+</b>
                  </button>
                  <!-- Dropdown menu -->
                  <div class="dropdown-menu">
                    <li class="list-group-item list-group-item-info">Loader Type</li>

                    <button type="button" class="list-group-item list-group-item-action" (click)="loaderInit('log')">log</button>
                    <button type="button" class="list-group-item list-group-item-action" (click)="loaderInit('OrientDB')">OrientDB</button>
                  </div>
                </div>
              </div>
              <br><br>
              <div id="loaderSpace" class="row">
                <h5 id="pleaseLoader" align="center"><b>Please create a loader</b></h5>
              </div>
            </div>
          </div>

          <br><br><br><br>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <div class="btn-toolbar">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-primary" (click)="setStep('1')">Back</button>
                </div>
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-primary" (click)="launch()" [disabled]="!readyForExecution()">Run Etl</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="stepThree" *ngSwitchCase="'3'">
          <h3 align="center">Step 3 - Monitor the Execution</h3>
          <h4 align="center">Console Log
            <button type="button" class="btn btn-sm btn-primary" data-toggle="popover" data-html="true"
                    [attr.data-content]="hints.executionHint" data-animation="am-fade-and-scale"><b>?</b></button>
          </h4>
          <div class="row row-space-2x">
            <div class="col-md-12">
              <h4 align="center"><b>The final json is temporarily displayed below</b></h4>
              <textarea  #logArea class="form-control" id="logArea" name="logArea" [(ngModel)]="finalJson"
                         rows="15" readonly></textarea> <!-- TODO object containing the log, finalJson is just a placeholder -->
            </div>
          </div>
          <br><br>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
              <div class="btn-toolbar">
                <div class="btn-group">
                  <button type="button" class="btn btn-sm btn-primary" (click)="setStep(1)">Restart</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <!-- TODO add the side panel with the configuration parameters -->

</div>
